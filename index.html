<!DOCTYPE html>
<html>
  <head>
    <title>Personagem controlável e animado</title>
    <script src="js/spritesheet.js"></script>
    <script src="js/animacao.js"></script>
    <script src="js/teclado.js"></script>
    <script src="js/personagemPrincipal.js"></script>
    <link rel="stylesheet" href="style.css" />
  </head>

  <body>
    <canvas id="canvas" width="1600" height="960"></canvas>
    <!-- AQUI INICIAR MUSICA DE SIRENE DE POLICIA, MUSICA DE AÇÃO OU ALGO DO GENERO -->
    <div id="wrapper">
      <div id="timer">30</div>
      <button id="startButton">Start</button>
      <p id="regras">
        A polícia está atrás de você, se esconda!
        <br><br>
        Encontre um local para se enconder dentro de 30 segundos e fique escondido até o tempo acabar para ganhar!
         <br><br>
         ⬅ Move para a Esquerda <br>
         ⮕ Move para a Direita  <br>
         ⬆ Move para Cima <br>
         ⬇ Move para Baixo <br>
         [SPACE] Entrar nos lugares
      </p>
    </div>
    <div id="wrapperVitoria">
      <div id="menuVitoria">
         <p id="TituloResultado">
            GANHOU!
         </p>
         <p id="DescricaoResultado">
            Você conseguiu escapar da polícia, Parabéns!
         </p>
         <a href="index.html">
            <button id="btnResultado">
               Jogar Novamente
            </button>
         </a>
      </div>
    </div>
    <div id="wrapperDerrota">
      <div id="menuDerrota">
         <p id="TituloResultado">
            PERDEU!
         </p>
         <p id="DescricaoResultado">
            Você foi pego pela polícia, tente novamente!
         </p>
         <a href="index.html">
            <button id="btnResultado">
               Tente Novamente
            </button>
         </a>
      </div>
    </div>
    <script>
      let segundos = 30;
      let intervalo;


      var canvas = document.getElementById("canvas");
      var context = canvas.getContext("2d");
      var timer = document.getElementById("timer")

      var teclado = new teclado(document);
      var animacao = new animacao(context);

      var imgPersonagemPrincipal = new Image();
      imgPersonagemPrincipal.src = "assets/PersonagemPrincipal.png";

      var personagemPrincipal = new personagemPrincipal(
        context,
        teclado,
        imgPersonagemPrincipal
      );
      personagemPrincipal.x = 1200;
      personagemPrincipal.y = 370;
      personagemPrincipal.direcao = PERSONAGEM_ESQUERDA;
      animacao.novoSprite(personagemPrincipal);

      imgPersonagemPrincipal.onload = function () {
        animacao.ligar();
      };

      function atualizarTimer(params) {
         segundos--
         timer.textContent = segundos;
         if (segundos == 0) {
            timer.textContent = 0;
            clearInterval(intervalo);
            intervalo = null;
            personagemPrincipal.podeCaminhar = false;
            console.log(personagemPrincipal.podeCaminhar);
            if(personagemPrincipal.escondido){
               document.getElementById('wrapperVitoria').style.display = 'flex';
               /* AQUI PARAR DE TOCAR A MUSICA AMBIENTE E TOCAR UMA MUSICA DE VITORIA */
            }else{
               document.getElementById('wrapperDerrota').style.display = 'flex';
               /* AQUI PARAR DE TOCAR A MUSICA AMBIENTE E COMECAR A TOCAR UMA MUSICA DE DERROTA */
            }
         }
      }

      document.getElementById("startButton").addEventListener("click", () => {
         if (!intervalo && segundos > 0) {
            intervalo = setInterval(atualizarTimer, 1000);
         } 
         personagemPrincipal.podeCaminhar = true;
      });
    </script>
  </body>
</html>
